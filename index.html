<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Untuk Kita, Dunia, dan Kotornya</title>
    <link href="https://fonts.googleapis.com/css2?family=Crimson+Text:italic&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --nadin-brown: #7c6a46;
            --nadin-beige: #f9f6f0;
            --petal-pink: #fbcce7;
            --sun-yellow: #ffda62;
        }

        body, html {
            margin: 0; padding: 0; background: var(--nadin-beige);
            color: #4a453c; font-family: 'Inter', sans-serif;
            overflow: hidden; height: 100vh; width: 100vw;
        }

        .screen {
            position: fixed; inset: 0; display: flex; flex-direction: column;
            align-items: center; justify-content: center; text-align: center;
            transition: opacity 1.5s ease; padding: 20px;
        }

        .hidden { opacity: 0; pointer-events: none; z-index: -1; }

        /* --- STAGE 1: INTRO VINE --- */
        .vine-svg { width: 250px; height: 350px; overflow: visible; }
        .vine-path { 
            fill: none; stroke: #8fa17d; stroke-width: 2.5; 
            stroke-dasharray: 1000; stroke-dashoffset: 1000; 
            stroke-linecap: round;
        }
        .animate-vine { animation: growVine 6s forwards ease-in-out; }
        @keyframes growVine { to { stroke-dashoffset: 0; } }

        .lyrics-box { font-family: 'Crimson Text', serif; font-style: italic; font-size: 1.5rem; margin-top: 20px; min-height: 40px; }

        /* --- STAGE 2: ENVELOPE --- */
        #stage2 { z-index: 50; }
        .envelope-wrapper { position: relative; width: 300px; height: 180px; background: #f2ede4; box-shadow: 0 10px 40px rgba(0,0,0,0.1); cursor: pointer; }
        .envelope-top { 
            position: absolute; top: 0; border-left: 150px solid transparent; border-right: 150px solid transparent; 
            border-top: 100px solid #e2ddd3; transform-origin: top; transition: transform 1.2s; z-index: 10; 
        }
        .open .envelope-top { transform: rotateX(180deg); z-index: 1; }

        .letter { 
            position: absolute; bottom: 5px; left: 5px; right: 5px; background: white; 
            height: 160px; transition: transform 2.5s cubic-bezier(0.19, 1, 0.22, 1), height 2s; 
            z-index: 5; padding: 30px 20px; overflow: hidden; box-sizing: border-box;
        }
        .open .letter { transform: translateY(-330px); height: 95vh; width: 340px; left: -20px; overflow-y: auto; }

        /* Bunga Detail (Lily & Matahari) */
        .detail-flowers { 
            display: flex; gap: 30px; justify-content: center; margin-top: 40px; 
            opacity: 0; transition: 2s 1.5s;
        }
        .open .detail-flowers { opacity: 1; }

        .f-item { cursor: pointer; text-align: center; }
        .f-icon { font-size: 50px; display: block; filter: drop-shadow(0 4px 4px rgba(0,0,0,0.1)); }
        
        /* Particles */
        .burst { position: absolute; pointer-events: none; z-index: 20; animation: fly 3s forwards; font-size: 24px; }
        @keyframes fly { to { transform: translate(var(--x), var(--y)) rotate(360deg); opacity: 0; } }

        /* --- MODAL DETAIL --- */
        #modal { 
            position: fixed; inset: 0; background: var(--nadin-beige); z-index: 1000; 
            display: flex; align-items: center; justify-content: center; 
            transition: 0.6s; opacity: 0; pointer-events: none;
        }
        #modal.active { opacity: 1; pointer-events: auto; }
        .modal-inner { max-width: 400px; width: 90%; text-align: center; }
        .ss-container { width: 100%; height: 280px; position: relative; overflow: hidden; margin: 20px 0; border: 1px solid #eee; }
        .ss-container img { width: 100%; height: 100%; object-fit: cover; position: absolute; inset: 0; opacity: 0; transition: 1.2s; }
        .ss-container img.active { opacity: 1; }

        .hint { font-size: 0.7rem; letter-spacing: 2px; text-transform: uppercase; margin-top: 30px; opacity: 0.4; }
        .close-btn { background: var(--nadin-brown); color: white; border: none; padding: 12px 25px; cursor: pointer; font-family: 'Crimson Text'; font-style: italic; margin-top: 20px; }
    </style>
</head>
<body onclick="app.next()">

    <audio id="bgm" loop><source src="tapi diterima.mp3" type="audio/mpeg"></audio>

    <div id="stage1" class="screen">
        <svg class="vine-svg" viewBox="0 0 100 200">
            <path class="vine-path" d="M50,200 Q50,150 50,130 T50,80 Q50,40 70,20" />
            <path class="vine-path" d="M50,140 Q30,120 35,90 Q40,60 55,40" />
            <path class="vine-path" d="M52,110 Q75,100 70,70 Q65,45 50,30" />
        </svg>
        <div id="lyrics" class="lyrics-box"></div>
        <p class="hint">Ketuk untuk menumbuhkan...</p>
    </div>

    <div id="stage2" class="screen hidden">
        <div class="envelope-wrapper" id="envelope">
            <div class="envelope-top"></div>
            <div class="letter">
                <div id="letter-content" style="opacity: 0; transition: 2s;">
                    <p style="font-size: 0.7rem; letter-spacing: 2px; opacity: 0.5;">REKONSILIASI</p>
                    <h1 style="font-family: 'Crimson Text'; font-weight: 400;">Untuk Kita, Dunia, dan Kotornya</h1>
                    <p style="font-style: italic; color: var(--nadin-brown);">"Segala kurangku, tapi diterima."</p>
                    
                    <div class="detail-flowers">
                        <div class="f-item" onclick="app.openDetail('sarah')">
                            <span class="f-icon">ðŸŒ¸</span>
                            <small>Sarah</small>
                        </div>
                        <div class="f-item" onclick="app.openDetail('amal')">
                            <span class="f-icon">ðŸŒ»</span>
                            <small>Amal</small>
                        </div>
                    </div>

                    <div style="margin-top: 60px; border-top: 1px solid #eee; padding-top: 30px;">
                        <p style="font-size: 0.85rem; line-height: 1.8;">Mungkin kemarin kita babak belur oleh keadaan. Namun mari pastikan semester ini kita lebih ikhlas. Mari mekar kembali.</p>
                        <p class="hint">Ketuk bunga untuk detail</p>
                    </div>
                </div>
            </div>
        </div>
        <p class="hint" id="env-hint">Ketuk amplop untuk membaca...</p>
    </div>

    <div id="modal">
        <div class="modal-inner">
            <h2 id="m-title" style="font-family: 'Crimson Text'; font-weight: 400;"></h2>
            <div class="ss-container" id="m-ss"></div>
            <p id="m-desc" style="font-size: 0.9rem; text-align: justify;"></p>
            <button class="close-btn" onclick="app.closeDetail()">Simpan Pesan</button>
        </div>
    </div>

    <script>
        const app = {
            step: 0,
            lyrics: ["Sempurna tak ada padaku...", "Atas harumnya kasihmu...", "Segala kurangku...", "Tapi diterima."],
            
            next() {
                const audio = document.getElementById('bgm');
                if (this.step === 0) {
                    audio.play().catch(() => {});
                    document.querySelectorAll('.vine-path').forEach(p => p.classList.add('animate-vine'));
                    this.runLyrics();
                    this.step = 1;
                } else if (this.step === 2) {
                    this.openEnvelope();
                    this.step = 3;
                }
            },

            runLyrics() {
                let i = 0;
                const box = document.getElementById('lyrics');
                const interval = setInterval(() => {
                    box.style.opacity = 0;
                    setTimeout(() => {
                        if (i < this.lyrics.length) {
                            box.innerText = this.lyrics[i];
                            box.style.opacity = 1;
                            i++;
                        } else {
                            clearInterval(interval);
                            setTimeout(() => this.showStage2(), 2000);
                        }
                    }, 800);
                }, 3000);
            },

            showStage2() {
                document.getElementById('stage1').style.opacity = 0;
                setTimeout(() => {
                    document.getElementById('stage1').classList.add('hidden');
                    document.getElementById('stage2').classList.remove('hidden');
                    this.step = 2;
                }, 1500);
            },

            openEnvelope() {
                const env = document.getElementById('envelope');
                env.classList.add('open');
                document.getElementById('env-hint').style.opacity = 0;
                
                // Burst effect
                for(let j=0; j<20; j++) {
                    const p = document.createElement('div');
                    p.className = 'burst';
                    p.innerHTML = Math.random() > 0.5 ? 'ðŸŒ¸' : 'ðŸŒ»';
                    p.style.setProperty('--x', `${(Math.random()-0.5)*400}px`);
                    p.style.setProperty('--y', `${-Math.random()*600}px`);
                    p.style.left = '50%'; p.style.top = '40%';
                    document.getElementById('stage2').appendChild(p);
                    setTimeout(() => p.remove(), 3000);
                }

                setTimeout(() => {
                    document.getElementById('letter-content').style.opacity = 1;
                }, 1000);
            },

            data: {
                sarah: {
                    t: "Lily Merah Muda - Sarah",
                    d: "Sarah, jika kemarin aku adalah duri yang tak sengaja melukai jemarimu, maafkan aku. Mari kita basuh debu yang lama, dan biarkan kita tumbuh lagi tanpa benci di semester 6 ini.",
                    i: ["sarah 1.jpeg", "sarah 2.jpeg", "kita 1.jpeg"]
                },
                amal: {
                    t: "Matahari Kuning - Amal",
                    d: "Amal, banyak kurangku yang kau dekap dengan sabar, meski aku seringkali hanya memberi bau tanah. Mari saling memaafkan agar di dunia yang kotor ini, kita tetap punya satu sama lain untuk pulang.",
                    i: ["amal 1.jpeg", "amal 2.jpeg", "kita 2.jpeg"]
                }
            },

            openDetail(key) {
                event.stopPropagation();
                const d = this.data[key];
                document.getElementById('m-title').innerText = d.t;
                document.getElementById('m-desc').innerText = d.d;
                const ss = document.getElementById('m-ss');
                ss.innerHTML = '';
                d.i.forEach((src, idx) => {
                    const img = document.createElement('img');
                    img.src = src;
                    if(idx === 0) img.className = 'active';
                    ss.appendChild(img);
                });
                document.getElementById('modal').classList.add('active');
                this.startSS();
            },

            closeDetail() {
                event.stopPropagation();
                document.getElementById('modal').classList.remove('active');
                clearInterval(this.timer);
            },

            startSS() {
                clearInterval(this.timer);
                this.timer = setInterval(() => {
                    const imgs = document.querySelectorAll('#m-ss img');
                    let act = 0;
                    imgs.forEach((img, i) => { if(img.classList.contains('active')) act = i; img.classList.remove('active'); });
                    imgs[(act + 1) % imgs.length].classList.add('active');
                }, 2500);
            }
        };
    </script>
</body>
</html>